<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Matcher - AI Powered Job Match Analysis</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .slide-in {
            animation: slideIn 0.3s ease forwards;
        }
        @keyframes slideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c5c5c5;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div x-data="resumeMatcher()" class="min-h-screen p-4 md:p-8">
        <div class="max-w-6xl mx-auto">
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Resume Matcher</h1>
                <p class="text-gray-600">AI-Powered Job Match Analysis</p>
            </header>

            <!-- Tabs -->
            <div class="flex border-b border-gray-200 mb-6">
                <button 
                    @click="activeTab = 'single'"
                    :class="{'border-b-2 border-blue-600 text-blue-600': activeTab === 'single'}"
                    class="py-2 px-4 font-medium">
                    Single Resume
                </button>
                <button 
                    @click="activeTab = 'multiple'"
                    :class="{'border-b-2 border-blue-600 text-blue-600': activeTab === 'multiple'}"
                    class="py-2 px-4 font-medium">
                    Batch Analysis
                </button>
                <button 
                    @click="activeTab = 'compare'"
                    :class="{'border-b-2 border-blue-600 text-blue-600': activeTab === 'compare'}"
                    class="py-2 px-4 font-medium">
                    Compare Resumes
                </button>
            </div>

            <!-- Single Resume Tab -->
            <div x-show="activeTab === 'single'" x-transition class="slide-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Resume Input -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4">Resume</h2>
                        <div class="flex mb-4">
                            <div class="flex-1">
                                <label class="cursor-pointer bg-gray-100 w-full h-12 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300 hover:bg-gray-200 transition">
                                    <i class="bi bi-file-earmark-pdf text-gray-600 mr-2"></i>
                                    <span class="text-gray-600">Upload PDF</span>
                                    <input type="file" accept=".pdf" @change="handleSingleResumeUpload($event)" class="hidden">
                                </label>
                            </div>
                            <span class="mx-2 flex items-center text-gray-400">or</span>
                            <button 
                                @click="resumePasteMode = !resumePasteMode" 
                                class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition">
                                Paste Text
                            </button>
                        </div>
                        <div x-show="singleResumeName" class="mb-4 flex items-center bg-blue-50 p-2 rounded">
                            <i class="bi bi-file-earmark-pdf text-blue-600 mr-2"></i>
                            <span x-text="singleResumeName" class="flex-1 truncate"></span>
                            <button @click="clearSingleResume" class="text-gray-500 hover:text-red-500">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </div>
                        <textarea 
                            x-model="resumeText"
                            x-show="resumePasteMode || !singleResumeName"
                            class="w-full h-64 p-4 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Paste your resume text here..."></textarea>
                    </div>

                    <!-- Job Description Input -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4">Job Description</h2>
                        <textarea 
                            x-model="jobDescription"
                            class="w-full h-64 p-4 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Paste the job description here..."></textarea>
                    </div>
                </div>

                <!-- Analysis Button -->
                <div class="text-center my-8">
                    <button 
                        @click="analyzeMatch()"
                        :disabled="isLoading || (!resumeText && !singleResumeName) || !jobDescription"
                        class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
                        <span x-show="!isLoading">Analyze Match</span>
                        <span x-show="isLoading" class="flex items-center justify-center">
                            <i class="bi bi-arrow-repeat loading-spinner mr-2"></i>
                            Analyzing...
                        </span>
                    </button>
                </div>

                <!-- Results Section -->
                <div x-show="results" x-transition class="bg-white p-6 rounded-lg shadow-md mb-8 slide-in">
                    <h2 class="text-2xl font-semibold mb-6">Analysis Results</h2>
                    
                    <!-- Match Score -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">Match Score</h3>
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div 
                                class="bg-blue-600 h-4 rounded-full transition-all duration-500"
                                :style="`width: ${results.matchScore || '0'}%`"></div>
                        </div>
                        <p class="text-right mt-1 text-gray-600"><span x-text="results.matchScore || '0'"></span>%</p>
                    </div>

                    <!-- Key Skills -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">Key Skills</h3>
                        <div class="flex flex-wrap gap-2">
                            <template x-for="skill in results.keySkills" :key="skill">
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm" x-text="skill"></span>
                            </template>
                        </div>
                    </div>

                    <!-- Education Summary -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">Education Summary</h3>
                        <p class="text-gray-700" x-text="results.educationSummary"></p>
                    </div>

                    <!-- Work Experience -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">Work Experience Summary</h3>
                        <p class="text-gray-700" x-text="results.workExperience"></p>
                    </div>

                    <!-- Role Titles -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">Previous Role Titles</h3>
                        <div class="flex flex-wrap gap-2">
                            <template x-for="role in results.roleTitles" :key="role">
                                <span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm" x-text="role"></span>
                            </template>
                        </div>
                    </div>

                    <!-- AI Summary -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Gemini AI Summary</h3>
                        <p class="text-gray-700" x-text="results.aiSummary"></p>
                    </div>
                </div>
            </div>

            <!-- Multiple Resume Tab -->
            <div x-show="activeTab === 'multiple'" x-transition class="slide-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Multiple Resume Upload -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4">Upload Resumes</h2>
                        <label class="cursor-pointer bg-gray-100 h-20 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300 hover:bg-gray-200 transition mb-4">
                            <div class="text-center">
                                <i class="bi bi-file-earmark-pdf text-gray-600 text-2xl mb-1"></i>
                                <div class="text-gray-600">Upload Multiple PDF Resumes</div>
                                <div class="text-sm text-gray-500">Drag & drop or click to browse</div>
                            </div>
                            <input type="file" accept=".pdf" @change="handleMultipleResumeUpload($event)" class="hidden" multiple>
                        </label>
                        
                        <!-- Resume List -->
                        <div class="max-h-64 overflow-y-auto border rounded-lg">
                            <template x-if="uploadedResumes.length === 0">
                                <div class="p-4 text-gray-500 text-center">
                                    No resumes uploaded yet
                                </div>
                            </template>
                            <ul>
                                <template x-for="(resume, index) in uploadedResumes" :key="index">
                                    <li class="border-b last:border-b-0 p-3 flex items-center">
                                        <i class="bi bi-file-earmark-pdf text-blue-600 mr-2"></i>
                                        <span class="flex-1 truncate" x-text="resume.name"></span>
                                        <div class="flex space-x-2">
                                            <span x-show="resume.status === 'processing'" class="text-yellow-600">
                                                <i class="bi bi-hourglass-split"></i>
                                            </span>
                                            <span x-show="resume.status === 'analyzed'" class="text-green-600">
                                                <i class="bi bi-check-circle"></i>
                                            </span>
                                            <span x-show="resume.status === 'error'" class="text-red-600">
                                                <i class="bi bi-exclamation-circle"></i>
                                            </span>
                                            <button @click="removeResume(index)" class="text-gray-500 hover:text-red-500">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Job Description for Batch -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4">Job Description</h2>
                        <textarea 
                            x-model="jobDescriptionBatch"
                            class="w-full h-64 p-4 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Paste the job description here..."></textarea>
                    </div>
                </div>
                
                <!-- Batch Analysis Button -->
                <div class="text-center my-8">
                    <button 
                        @click="analyzeBatch()"
                        :disabled="isBatchLoading || uploadedResumes.length === 0 || !jobDescriptionBatch"
                        class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
                        <span x-show="!isBatchLoading">Analyze All Resumes</span>
                        <span x-show="isBatchLoading" class="flex items-center justify-center">
                            <i class="bi bi-arrow-repeat loading-spinner mr-2"></i>
                            Analyzing <span x-text="currentBatchProgress"></span>/<span x-text="uploadedResumes.length"></span>
                        </span>
                    </button>
                </div>
                
                <!-- Batch Results -->
                <div x-show="batchResults.length > 0" x-transition class="bg-white p-6 rounded-lg shadow-md mb-8 slide-in">
                    <h2 class="text-2xl font-semibold mb-6">Analysis Results</h2>
                    
                    <!-- Sorting Controls -->
                    <div class="flex justify-between mb-4 items-center">
                        <h3 class="text-lg font-semibold">Ranked Resumes</h3>
                        <div class="flex space-x-2 items-center">
                            <span class="text-gray-600">Sort by:</span>
                            <select 
                                x-model="sortCriteria"
                                @change="sortBatchResults()"
                                class="border rounded p-1">
                                <option value="score">Match Score</option>
                                <option value="education">Education</option>
                                <option value="experience">Experience</option>
                                <option value="skills">Skills</option>
                            </select>
                            <button 
                                @click="sortDirection = sortDirection === 'asc' ? 'desc' : 'asc'; sortBatchResults()"
                                class="p-1 rounded hover:bg-gray-100">
                                <i :class="sortDirection === 'asc' ? 'bi-sort-up' : 'bi-sort-down'" class="bi"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Resume Cards -->
                    <div class="space-y-4">
                        <template x-for="(result, index) in batchResults" :key="index">
                            <div class="border rounded-lg p-4 hover:shadow-md transition">
                                <div class="flex justify-between items-center mb-3">
                                    <h4 class="text-lg font-medium" x-text="result.name"></h4>
                                    <div class="flex items-center">
                                        <span class="font-semibold text-blue-600 mr-2" x-text="`${result.matchScore}%`"></span>
                                        <button 
                                            @click="toggleResumeDetails(index)" 
                                            class="text-gray-500 hover:text-gray-700">
                                            <i :class="expandedResumes.includes(index) ? 'bi-chevron-up' : 'bi-chevron-down'" class="bi"></i>
                                        </button>
                                        <button 
                                            @click="addToComparison(result)" 
                                            class="ml-2 text-gray-500 hover:text-blue-600"
                                            :class="isInComparison(result) ? 'text-blue-600' : ''">
                                            <i class="bi bi-plus-circle"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Match Score Bar -->
                                <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                                    <div 
                                        class="bg-blue-600 h-2 rounded-full transition-all duration-500"
                                        :style="`width: ${result.matchScore || '0'}%`"></div>
                                </div>
                                
                                <!-- Skills Preview -->
                                <div class="mb-3">
                                    <div class="flex flex-wrap gap-1">
                                        <template x-for="(skill, i) in result.keySkills.slice(0, expandedResumes.includes(index) ? undefined : 5)" :key="i">
                                            <span class="bg-blue-100 text-blue-800 px-2 py-0.5 text-xs rounded-full" x-text="skill"></span>
                                        </template>
                                        <template x-if="!expandedResumes.includes(index) && result.keySkills.length > 5">
                                            <span class="bg-gray-100 text-gray-800 px-2 py-0.5 text-xs rounded-full" x-text="`+${result.keySkills.length - 5} more`"></span>
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- Expanded Details -->
                                <div x-show="expandedResumes.includes(index)" x-collapse>
                                    <hr class="my-3">
                                    
                                    <!-- Education Summary -->
                                    <div class="mb-3">
                                        <h5 class="font-medium text-gray-700 mb-1">Education</h5>
                                        <p class="text-sm text-gray-600" x-text="result.educationSummary"></p>
                                    </div>
                                    
                                    <!-- Work Experience -->
                                    <div class="mb-3">
                                        <h5 class="font-medium text-gray-700 mb-1">Work Experience</h5>
                                        <p class="text-sm text-gray-600" x-text="result.workExperience"></p>
                                    </div>
                                    
                                    <!-- Role Titles -->
                                    <div class="mb-3">
                                        <h5 class="font-medium text-gray-700 mb-1">Previous Roles</h5>
                                        <div class="flex flex-wrap gap-1">
                                            <template x-for="role in result.roleTitles" :key="role">
                                                <span class="bg-gray-100 text-gray-800 px-2 py-0.5 text-xs rounded-full" x-text="role"></span>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <!-- AI Summary -->
                                    <div>
                                        <h5 class="font-medium text-gray-700 mb-1">Gemini AI Summary</h5>
                                        <p class="text-sm text-gray-600" x-text="result.aiSummary"></p>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Compare Tab -->
            <div x-show="activeTab === 'compare'" x-transition class="slide-in">
                <div x-show="comparisonResumes.length === 0" class="bg-white p-6 rounded-lg shadow-md text-center">
                    <div class="text-gray-500 mb-4">
                        <i class="bi bi-arrow-left-right text-5xl mb-2"></i>
                        <p>Add resumes to comparison from the Batch Analysis tab</p>
                    </div>
                    <button 
                        @click="activeTab = 'multiple'"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-all duration-200">
                        Go to Batch Analysis
                    </button>
                </div>

                <div x-show="comparisonResumes.length > 0" class="space-y-6">
                    <!-- Comparison Controls -->
                    <div class="bg-white p-4 rounded-lg shadow-md mb-4">
                        <div class="flex flex-wrap justify-between items-center">
                            <h2 class="text-xl font-semibold">Resume Comparison</h2>
                            <div class="flex space-x-2">
                                <select 
                                    x-model="comparisonCategory" 
                                    class="border rounded p-2">
                                    <option value="all">All Categories</option>
                                    <option value="matchScore">Match Score</option>
                                    <option value="keySkills">Skills</option>
                                    <option value="education">Education</option>
                                    <option value="workExperience">Work Experience</option>
                                    <option value="roleTitles">Role Titles</option>
                                </select>
                                <button 
                                    @click="clearComparison()"
                                    class="bg-gray-200 text-gray-700 px-3 py-2 rounded hover:bg-gray-300 transition">
                                    Clear All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Resume Chips -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <template x-for="(resume, index) in comparisonResumes" :key="index">
                            <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm flex items-center">
                                <span x-text="resume.name"></span>
                                <button @click="removeFromComparison(index)" class="ml-2 text-blue-600 hover:text-blue-800">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </template>
                    </div>

                    <!-- Comparison Display -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <!-- Match Score Comparison -->
                        <div x-show="comparisonCategory === 'all' || comparisonCategory === 'matchScore'" class="mb-8">
                            <h3 class="text-lg font-semibold mb-4">Match Score</h3>
                            <div class="space-y-4">
                                <template x-for="(resume, index) in comparisonResumes" :key="index">
                                    <div>
                                        <div class="flex items-center mb-1">
                                            <div class="w-24 truncate mr-2" x-text="resume.name"></div>
                                            <div class="flex-1">
                                                <div class="w-full bg-gray-200 rounded-full h-4">
                                                    <div 
                                                        class="bg-blue-600 h-4 rounded-full transition-all duration-500"
                                                        :style="`width: ${resume.matchScore || '0'}%`"></div>
                                                </div>
                                            </div>
                                            <div class="ml-2 w-12 text-right" x-text="`${resume.matchScore}%`"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Skills Comparison -->
                        <div x-show="comparisonCategory === 'all' || comparisonCategory === 'keySkills'" class="mb-8">
                            <h3 class="text-lg font-semibold mb-4">Skills</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border-collapse">
                                    <thead>
                                        <tr>
                                            <th class="border-b px-4 py-2 text-left">Resume</th>
                                            <th class="border-b px-4 py-2 text-left">Skills</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(resume, index) in comparisonResumes" :key="index">
                                            <tr>
                                                <td class="border-b px-4 py-3 align-top w-1/4" x-text="resume.name"></td>
                                                <td class="border-b px-4 py-3">
                                                    <div class="flex flex-wrap gap-1">
                                                        <template x-for="skill in resume.keySkills" :key="skill">
                                                            <span class="bg-blue-100 text-blue-800 px-2 py-0.5 text-xs rounded-full" x-text="skill"></span>
                                                        </template>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Education Comparison -->
                        <div x-show="comparisonCategory === 'all' || comparisonCategory === 'education'" class="mb-8">
                            <h3 class="text-lg font-semibold mb-4">Education</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border-collapse">
                                    <thead>
                                        <tr>
                                            <th class="border-b px-4 py-2 text-left">Resume</th>
                                            <th class="border-b px-4 py-2 text-left">Education</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(resume, index) in comparisonResumes" :key="index">
                                            <tr>
                                                <td class="border-b px-4 py-3 align-top w-1/4" x-text="resume.name"></td>
                                                <td class="border-b px-4 py-3" x-text="resume.educationSummary"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Work Experience Comparison -->
                        <div x-show="comparisonCategory === 'all' || comparisonCategory === 'workExperience'" class="mb-8">
                            <h3 class="text-lg font-semibold mb-4">Work Experience</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border-collapse">
                                    <thead>
                                        <tr>
                                            <th class="border-b px-4 py-2 text-left">Resume</th>
                                            <th class="border-b px-4 py-2 text-left">Experience</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(resume, index) in comparisonResumes" :key="index">
                                            <tr>
                                                <td class="border-b px-4 py-3 align-top w-1/4" x-text="resume.name"></td>
                                                <td class="border-b px-4 py-3" x-text="resume.workExperience"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Role Titles Comparison -->
                        <div x-show="comparisonCategory === 'all' || comparisonCategory === 'roleTitles'" class="mb-8">
                            <h3 class="text-lg font-semibold mb-4">Previous Roles</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border-collapse">
                                    <thead>
                                        <tr>
                                            <th class="border-b px-4 py-2 text-left">Resume</th>
                                            <th class="border-b px-4 py-2 text-left">Roles</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(resume, index) in comparisonResumes" :key="index">
                                            <tr>
                                                <td class="border-b px-4 py-3 align-top w-1/4" x-text="resume.name"></td>
                                                <td class="border-b px-4 py-3">
                                                    <div class="flex flex-wrap gap-1">
                                                        <template x-for="role in resume.roleTitles" :key="role">
                                                            <span class="bg-gray-100 text-gray-800 px-2 py-0.5 text-xs rounded-full" x-text="role"></span>
                                                        </template>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error Alert -->
            <div 
                x-show="error" 
                x-transition
                class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-8"
                role="alert">
                <strong class="font-bold">Error!</strong>
                <span class="block sm:inline" x-text="error"></span>
                <button @click="error = null" class="absolute top-0 right-0 p-3">
                    <i class="bi bi-x"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        function resumeMatcher() {
            return {
                // Tabs
                activeTab: 'single',
                
                // Single resume analysis
                resumeText: '',
                jobDescription: '',
                isLoading: false,
                results: null,
                error: null,
                resumePasteMode: true,
                singleResumeName: '',
                singleResumeFile: null,
                
                // Batch analysis
                uploadedResumes: [],
                jobDescriptionBatch: '',
                batchResults: [],
                isBatchLoading: false,
                currentBatchProgress: 0,
                expandedResumes: [],
                sortCriteria: 'score',
                sortDirection: 'desc',
                
                // Comparison
                comparisonResumes: [],
                comparisonCategory: 'all',
                
                // Initialize the component
                init() {
                    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
                },
                
                // Handle Single Resume Upload
                async handleSingleResumeUpload(event) {
                    const file = event.target.files[0];
                    if (!file || !file.type.includes('pdf')) {
                        this.error = "Please upload a PDF file";
                        return;
                    }
                    
                    this.singleResumeName = file.name;
                    this.singleResumeFile = file;
                    this.resumeText = await this.extractTextFromPdf(file);
                },
                
                // Clear single resume
                clearSingleResume() {
                    this.singleResumeName = '';
                    this.singleResumeFile = null;
                    this.resumeText = '';
                },
                
                // Handle Multiple Resume Upload
                async handleMultipleResumeUpload(event) {
                    const files = event.target.files;
                    if (!files || files.length === 0) return;
                    
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        if (!file.type.includes('pdf')) {
                            this.error = `${file.name} is not a PDF file`;
                            continue;
                        }
                        
                        this.uploadedResumes.push({
                            name: file.name,
                            file: file,
                            text: '',
                            status: 'pending',
                            result: null
                        });
                        
                        // Extract text from PDF
                        try {
                            const resumeIndex = this.uploadedResumes.length - 1;
                            this.uploadedResumes[resumeIndex].status = 'processing';
                            const text = await this.extractTextFromPdf(file);
                            this.uploadedResumes[resumeIndex].text = text;
                            this.uploadedResumes[resumeIndex].status = 'ready';
                        } catch (err) {
                            const resumeIndex = this.uploadedResumes.length - 1;
                            this.uploadedResumes[resumeIndex].status = 'error';
                            console.error('Error extracting text from PDF:', err);
                        }
                    }
                    
                    // Reset file input
                    event.target.value = '';
                },
                
                // Remove resume from batch
                removeResume(index) {
                    this.uploadedResumes.splice(index, 1);
                },
                
                // Extract text from PDF
                async extractTextFromPdf(file) {
                    try {
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                        let text = '';
                        
                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const content = await page.getTextContent();
                            const strings = content.items.map(item => item.str);
                            text += strings.join(' ') + '\n';
                        }
                        
                        return text;
                    } catch (err) {
                        console.error('Error extracting text from PDF:', err);
                        throw err;
                    }
                },
                
                // Single Resume Analysis
                async analyzeMatch() {
                    this.isLoading = true;
                    this.error = null;
                    this.results = null;

                    try {
                        const prompt = `Compare this resume to the job description below:

                        Resume:
                        ${this.resumeText}

                        Job Description:
                        ${this.jobDescription}

                        Extract and return:
                        1. Match Score (0-100%)
                        2. Key Skills
                        3. Education Summary
                        4. Work Experience Summary
                        5. Role Titles
                        6. Gemini Summary of the Resume`;

                        const response = await fetch(
                            'https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/ai',
                            {
                                method: 'POST',
                                headers: {
                                    'Authorization': 'Bearer Ampfv3bmH3bN2w6L3MP9lz2uHme2',
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    messages: [
                                        {
                                            role: "user",
                                            content: [
                                                {
                                                    type: "text",
                                                    text: prompt
                                                }
                                            ]
                                        }
                                    ]
                                })
                            }
                        );

                        if (!response.ok) {
                            throw new Error('Failed to connect to the AI service');
                        }

                        const data = await response.json();
                        
                        // Parse the AI response and structure it
                        const aiResponse = data.message;
                        
                        // Simple parsing logic
                        const matchScore = parseInt(aiResponse.match(/Match Score.*?(\d+)/)?.[1] || '0');
                        const keySkills = aiResponse.match(/Key Skills:(.*?)(?=Education|$)/s)?.[1].trim().split(',').map(s => s.trim()) || [];
                        const educationSummary = aiResponse.match(/Education Summary:(.*?)(?=Work|$)/s)?.[1].trim();
                        const workExperience = aiResponse.match(/Work Experience Summary:(.*?)(?=Role|$)/s)?.[1].trim();
                        const roleTitles = aiResponse.match(/Role Titles:(.*?)(?=Gemini|$)/s)?.[1].trim().split(',').map(s => s.trim()) || [];
                        const aiSummary = aiResponse.match(/Gemini Summary:(.*?)$/s)?.[1].trim();

                        this.results = {
                            matchScore,
                            keySkills,
                            educationSummary,
                            workExperience,
                            roleTitles,
                            aiSummary
                        };
                    } catch (err) {
                        // Try the alternative API if the first one fails
                        try {
                            const prompt = `Compare this resume to the job description below:

                            Resume:
                            ${this.resumeText}

                            Job Description:
                            ${this.jobDescription}

                            Extract and return:
                            1. Match Score (0-100%)
                            2. Key Skills
                            3. Education Summary
                            4. Work Experience Summary
                            5. Role Titles
                            6. Gemini Summary of the Resume`;

                            const response = await fetch(
                                'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyBkjGorMt4B9FUYjngB32M-LCQL_acEzMM',
                                {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        contents: [{
                                            parts: [{
                                                text: prompt
                                            }]
                                        }]
                                    })
                                }
                            );

                            if (!response.ok) {
                                throw new Error('Failed to connect to the AI service');
                            }

                            const data = await response.json();
                            
                            // Parse the AI response and structure it
                            const aiResponse = data.candidates[0].content.parts[0].text;
                            
                            // Simple parsing logic
                            const matchScore = parseInt(aiResponse.match(/Match Score.*?(\d+)/)?.[1] || '0');
                            const keySkills = aiResponse.match(/Key Skills:(.*?)(?=Education|$)/s)?.[1].trim().split(',').map(s => s.trim()) || [];
                            const educationSummary = aiResponse.match(/Education Summary:(.*?)(?=Work|$)/s)?.[1].trim();
                            const workExperience = aiResponse.match(/Work Experience Summary:(.*?)(?=Role|$)/s)?.[1].trim();
                            const roleTitles = aiResponse.match(/Role Titles:(.*?)(?=Gemini|$)/s)?.[1].trim().split(',').map(s => s.trim()) || [];
                            const aiSummary = aiResponse.match(/Gemini Summary:(.*?)$/s)?.[1].trim();

                            this.results = {
                                matchScore,
                                keySkills,
                                educationSummary,
                                workExperience,
                                roleTitles,
                                aiSummary
                            };
                        } catch (secondErr) {
                            this.error = secondErr.message || 'An error occurred during analysis';
                            console.error('Error with backup API:', secondErr);
                        }
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                // Batch Analysis
                async analyzeBatch() {
                    if (this.uploadedResumes.length === 0 || !this.jobDescriptionBatch) {
                        this.error = "Please upload resumes and provide a job description";
                        return;
                    }
                    
                    this.isBatchLoading = true;
                    this.error = null;
                    this.currentBatchProgress = 0;
                    
                    for (let i = 0; i < this.uploadedResumes.length; i++) {
                        const resume = this.uploadedResumes[i];
                        this.currentBatchProgress = i + 1;
                        
                        try {
                            if (!resume.text) {
                                resume.text = await this.extractTextFromPdf(resume.file);
                            }
                            
                            resume.status = 'processing';
                            
                            const prompt = `Compare this resume to the job description below:

                            Resume:
                            ${resume.text}

                            Job Description:
                            ${this.jobDescriptionBatch}

                            Extract and return:
                            1. Match Score (0-100%)
                            2. Key Skills
                            3. Education Summary
                            4. Work Experience Summary
                            5. Role Titles
                            6. Gemini Summary of the Resume`;

                            // Try the first API endpoint
                            try {
                                const response = await fetch(
                                    'https://r0c8kgwocscg8gsokogwwsw4.zetaverse.one/ai',
                                    {
                                        method: 'POST',
                                        headers: {
                                            'Authorization': 'Bearer Ampfv3bmH3bN2w6L3MP9lz2uHme2',
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            messages: [
                                                {
                                                    role: "user",
                                                    content: [
                                                        {
                                                            type: "text",
                                                            text: prompt
                                                        }
                                                    ]
                                                }
                                            ]
                                        })
                                    }
                                );

                                if (!response.ok) {
                                    throw new Error(`Failed to analyze ${resume.name}`);
                                }

                                const data = await response.json();
                                const aiResponse = data.message;
                                
                                // Parse AI response
                                const matchScore = parseInt(aiResponse.match(/Match Score.*?(\d+)/)?.[1] || '0');
                                const keySkills = aiResponse.match(/Key Skills:(.*?)(?=Education|$)/s)?.[1].trim().split(',').map(s => s.trim()) || [];
                                const educationSummary = aiResponse.match(/Education Summary:(.*?)(?=Work|$)/s)?.[1].trim();
                                const workExperience = aiResponse.match(/Work Experience Summary:(.*?)(?=Role|$)/s)?.[1].trim();
                                const roleTitles = aiResponse.match(/Role Titles:(.*?)(?=Gemini|$)/s)?.[1].trim().split(',').map(s => s.trim()) || [];
                                const aiSummary = aiResponse.match(/Gemini Summary:(.*?)$/s)?.[1].trim();
                                
                                const result = {
                                    name: resume.name,
                                    matchScore,
                                    keySkills,
                                    educationSummary,
                                    workExperience,
                                    roleTitles,
                                    aiSummary
                                };
                                
                                resume.result = result;
                                resume.status = 'analyzed';
                                
                                // Add to batch results if not already there
                                const existingIndex = this.batchResults.findIndex(r => r.name === resume.name);
                                if (existingIndex >= 0) {
                                    this.batchResults[existingIndex] = result;
                                } else {
                                    this.batchResults.push(result);
                                }
                            } catch (firstApiError) {
                                // Try the second API endpoint if the first fails
                                const response = await fetch(
                                    'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyBkjGorMt4B9FUYjngB32M-LCQL_acEzMM',
                                    {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            contents: [{
                                                parts: [{
                                                    text: prompt
                                                }]
                                            }]
                                        })
                                    }
                                );

                                if (!response.ok) {
                                    throw new Error(`Failed to analyze ${resume.name}`);
                                }

                                const data = await response.json();
                                const aiResponse = data.candidates[0].content.parts[0].text;
                                
                                // Parse AI response
                                const matchScore = parseInt(aiResponse.match(/Match Score.*?(\d+)/)?.[1] || '0');
                                const keySkills = aiResponse.match(/Key Skills:(.*?)(?=Education|$)/s)?.[1].trim().split(',').map(s => s.trim()) || [];
                                const educationSummary = aiResponse.match(/Education Summary:(.*?)(?=Work|$)/s)?.[1].trim();
                                const workExperience = aiResponse.match(/Work Experience Summary:(.*?)(?=Role|$)/s)?.[1].trim();
                                const roleTitles = aiResponse.match(/Role Titles:(.*?)(?=Gemini|$)/s)?.[1].trim().split(',').map(s => s.trim()) || [];
                                const aiSummary = aiResponse.match(/Gemini Summary:(.*?)$/s)?.[1].trim();
                                
                                const result = {
                                    name: resume.name,
                                    matchScore,
                                    keySkills,
                                    educationSummary,
                                    workExperience,
                                    roleTitles,
                                    aiSummary
                                };
                                
                                resume.result = result;
                                resume.status = 'analyzed';
                                
                                // Add to batch results if not already there
                                const existingIndex = this.batchResults.findIndex(r => r.name === resume.name);
                                if (existingIndex >= 0) {
                                    this.batchResults[existingIndex] = result;
                                } else {
                                    this.batchResults.push(result);
                                }
                            }
                            
                        } catch (err) {
                            resume.status = 'error';
                            console.error('Error analyzing resume:', err);
                            this.error = err.message || 'An error occurred during batch analysis';
                        }
                    }
                    
                    // Sort batch results by match score
                    this.sortBatchResults();
                    this.isBatchLoading = false;
                },
                
                // Toggle Resume Details
                toggleResumeDetails(index) {
                    if (this.expandedResumes.includes(index)) {
                        this.expandedResumes = this.expandedResumes.filter(i => i !== index);
                    } else {
                        this.expandedResumes.push(index);
                    }
                },
                
                // Sort batch results
                sortBatchResults() {
                    this.batchResults.sort((a, b) => {
                        let compareA, compareB;
                        
                        switch (this.sortCriteria) {
                            case 'score':
                                compareA = a.matchScore;
                                compareB = b.matchScore;
                                break;
                            case 'education':
                                compareA = a.educationSummary.length;
                                compareB = b.educationSummary.length;
                                break;
                            case 'experience':
                                compareA = a.workExperience.length;
                                compareB = b.workExperience.length;
                                break;
                            case 'skills':
                                compareA = a.keySkills.length;
                                compareB = b.keySkills.length;
                                break;
                            default:
                                compareA = a.matchScore;
                                compareB = b.matchScore;
                        }
                        
                        return this.sortDirection === 'asc' 
                            ? compareA - compareB 
                            : compareB - compareA;
                    });
                },
                
                // Add to comparison
                addToComparison(resume) {
                    if (!this.isInComparison(resume)) {
                        this.comparisonResumes.push(resume);
                    }
                },
                
                // Check if resume is in comparison
                isInComparison(resume) {
                    return this.comparisonResumes.some(r => r.name === resume.name);
                },
                
                // Remove from comparison
                removeFromComparison(index) {
                    this.comparisonResumes.splice(index, 1);
                },
                
                // Clear comparison
                clearComparison() {
                    this.comparisonResumes = [];
                }
            }
        }
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>